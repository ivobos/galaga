var M=Object.defineProperty;var b=(x,e,i)=>e in x?M(x,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):x[e]=i;var o=(x,e,i)=>b(x,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function t(s){if(s.ep)return;s.ep=!0;const h=i(s);fetch(s.href,h)}})();class A{constructor(){o(this,"audioContext",null);o(this,"masterGain",null);o(this,"enabled",!0);console.log("Sound manager created, waiting for user interaction")}initializeAudio(){this.audioContext||(console.log("Initializing audio context"),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),console.log("Audio context created, state:",this.audioContext.state))}resumeAudio(){this.audioContext||this.initializeAudio(),this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume().then(()=>{console.log("Audio context resumed successfully")}).catch(e=>{console.error("Failed to resume audio context:",e)})}playShoot(){if(!this.enabled||!this.audioContext||this.audioContext.state!=="running")return;const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.type="square",e.frequency.setValueAtTime(880,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(110,this.audioContext.currentTime+.1),i.gain.setValueAtTime(.08,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.1),e.connect(i),i.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.1)}playBombDrop(){if(!this.enabled||!this.audioContext||this.audioContext.state!=="running")return;const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(440,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(220,this.audioContext.currentTime+.3),i.gain.setValueAtTime(.02,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.3),e.connect(i),i.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.3)}playExplosion(){if(!this.enabled||!this.audioContext||this.audioContext.state!=="running")return;const e=this.audioContext.createBufferSource(),i=this.audioContext.createBuffer(1,this.audioContext.sampleRate*.3,this.audioContext.sampleRate),t=i.getChannelData(0);for(let a=0;a<i.length;a++)t[a]=Math.random()*2-1;e.buffer=i;const s=this.audioContext.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(1e3,this.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(100,this.audioContext.currentTime+.3);const h=this.audioContext.createGain();h.gain.setValueAtTime(.1,this.audioContext.currentTime),h.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.3),e.connect(s),s.connect(h),h.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.3)}playGameOver(){if(!this.enabled||!this.audioContext||this.audioContext.state!=="running")return;const e=this.audioContext.createBufferSource(),i=this.audioContext.createBuffer(1,this.audioContext.sampleRate*2,this.audioContext.sampleRate),t=i.getChannelData(0);for(let l=0;l<i.length;l++){const r=1-l/i.length;t[l]=(Math.random()*2-1)*r}e.buffer=i;const s=this.audioContext.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(2e3,this.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+2);const h=this.audioContext.createGain();h.gain.setValueAtTime(.15,this.audioContext.currentTime),h.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+2);const a=this.audioContext.createOscillator();a.type="sine",a.frequency.setValueAtTime(220,this.audioContext.currentTime),a.frequency.exponentialRampToValueAtTime(110,this.audioContext.currentTime+2);const c=this.audioContext.createGain();c.gain.setValueAtTime(.05,this.audioContext.currentTime),c.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+2),e.connect(s),s.connect(h),h.connect(this.masterGain),a.connect(c),c.connect(this.masterGain),e.start(),a.start(),e.stop(this.audioContext.currentTime+2),a.stop(this.audioContext.currentTime+2)}playAlienTurn(){if(!this.enabled||!this.audioContext||this.audioContext.state!=="running")return;const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(330,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(440,this.audioContext.currentTime+.2),i.gain.setValueAtTime(.03,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.2),e.connect(i),i.connect(this.masterGain),e.start(),e.stop(this.audioContext.currentTime+.2)}playAlienHover(e){if(!this.enabled||!this.audioContext||this.audioContext.state!=="running")return;const i=this.audioContext.createOscillator(),t=this.audioContext.createGain();switch(e){case 1:i.type="sawtooth",i.frequency.setValueAtTime(880,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(1760,this.audioContext.currentTime+.05),t.gain.setValueAtTime(.015,this.audioContext.currentTime);break;case 2:i.type="square",i.frequency.setValueAtTime(660,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(880,this.audioContext.currentTime+.05),t.gain.setValueAtTime(.02,this.audioContext.currentTime);break;case 3:i.type="sawtooth",i.frequency.setValueAtTime(440,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(660,this.audioContext.currentTime+.05),t.gain.setValueAtTime(.018,this.audioContext.currentTime);break}t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.05),i.connect(t),t.connect(this.masterGain),i.start(),i.stop(this.audioContext.currentTime+.05)}toggle(){this.enabled=!this.enabled,console.log("Sound toggled:",this.enabled?"on":"off"),this.enabled&&this.resumeAudio()}isEnabled(){return this.enabled}setGameOver(e){this.enabled=!e}}class k{constructor(){o(this,"canvas");o(this,"ctx");o(this,"player");o(this,"bullets");o(this,"aliens");o(this,"bombs");o(this,"explosions");o(this,"stars");o(this,"keys");o(this,"lastBulletTime");o(this,"BULLET_COOLDOWN",100);o(this,"MAX_PLAYER_BULLETS",5);o(this,"gameOver");o(this,"gameStartTime");o(this,"gameOverTime");o(this,"MIN_GAME_OVER_DURATION",3e3);o(this,"soundManager");o(this,"score");o(this,"highScore");o(this,"level");o(this,"levelStartTime");o(this,"LEVEL_START_DELAY",2e3);o(this,"gameStarted");o(this,"starPulseTime");o(this,"scale",1);o(this,"isPaused",!1);console.log("Game constructor started"),this.canvas=document.getElementById("gameCanvas"),console.log("Canvas element found:",this.canvas),this.ctx=this.canvas.getContext("2d"),console.log("Canvas context created:",this.ctx),this.handleResize(),console.log("Initial resize complete. Canvas size:",this.canvas.width,"x",this.canvas.height),window.addEventListener("resize",()=>this.handleResize()),this.player={x:this.canvas.width/2,y:this.canvas.height-100,width:30*this.scale,height:30*this.scale,speed:5*this.scale},console.log("Player initialized:",this.player),this.bullets=[],this.aliens=[],this.bombs=[],this.explosions=[],this.stars=[],this.keys={},this.lastBulletTime=0,this.gameOver=!1,this.gameStarted=!1,this.gameStartTime=Date.now(),this.gameOverTime=0,this.starPulseTime=0,this.soundManager=new A,console.log("Sound manager initialized"),this.score=0,this.highScore=parseInt(localStorage.getItem("galagaHighScore")||"0"),this.level=1,this.levelStartTime=Date.now(),this.initStars(),console.log("Stars initialized:",this.stars.length),this.isMobile()?(console.log("Mobile device detected"),this.canvas.style.touchAction="none",document.addEventListener("touchstart",()=>{console.log("Touch detected, attempting fullscreen"),this.soundManager&&(this.soundManager.resumeAudio(),console.log("Audio context resumed")),document.documentElement.requestFullscreen().catch(e=>{console.log("Error attempting to enable fullscreen:",e)})},{once:!0})):console.log("Desktop device detected"),window.addEventListener("keydown",e=>{this.keys[e.key]=!0,this.soundManager&&this.soundManager.resumeAudio()}),window.addEventListener("keyup",e=>this.keys[e.key]=!1),window.addEventListener("keydown",e=>{e.key.toLowerCase()==="m"&&this.soundManager.toggle()}),console.log("Keyboard event listeners added"),this.canvas.addEventListener("touchstart",e=>{console.log("Touch start event"),e.preventDefault(),this.soundManager&&this.soundManager.resumeAudio();const i=e.touches[0],t=this.canvas.getBoundingClientRect(),s=i.clientX-t.left,h=i.clientY-t.top;console.log("Touch coordinates:",s,h);const a=10,c=this.canvas.height-10;if(s>=a&&s<=a+150&&h>=c-20&&h<=c){console.log("Sound toggle area touched"),this.soundManager.toggle();return}this.handleTouch(e)}),this.canvas.addEventListener("touchmove",e=>{e.preventDefault(),this.handleTouch(e)}),this.canvas.addEventListener("touchend",e=>{e.preventDefault(),this.keys[" "]=!1}),console.log("Touch event listeners added"),this.canvas.addEventListener("click",e=>{console.log("Click event"),this.soundManager&&this.soundManager.resumeAudio();const i=this.canvas.getBoundingClientRect(),t=e.clientX-i.left,s=e.clientY-i.top;console.log("Click coordinates:",t,s);const h=10,a=this.canvas.height-10;if(t>=h&&t<=h+150&&s>=a-20&&s<=a){console.log("Sound toggle area clicked"),this.soundManager.toggle();return}this.gameStarted?this.gameOver&&Date.now()-this.gameOverTime>=this.MIN_GAME_OVER_DURATION&&(console.log("Resetting game"),this.reset()):(console.log("Starting game"),this.gameStarted=!0,this.initAliens())}),console.log("Click event listener added"),console.log("Starting game loop"),this.gameLoop()}isMobile(){const e="ontouchstart"in window||navigator.maxTouchPoints>0,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return e||i}handleResize(){console.log("Handling resize");const e=window.innerWidth,i=window.innerHeight;console.log("Window dimensions:",e,"x",i);const t=9/16;if(this.isMobile())console.log("Mobile resize"),this.canvas.width=e,this.canvas.height=this.canvas.width/t,this.canvas.height>i&&(this.canvas.height=i,this.canvas.width=this.canvas.height*t);else{console.log("Desktop resize");const s=540,h=960,a=e/s,c=i/h;this.scale=Math.min(a,c)*.9,this.canvas.width=s*this.scale,this.canvas.height=h*this.scale}console.log("New canvas size:",this.canvas.width,"x",this.canvas.height,"scale:",this.scale),this.canvas.style.position="absolute",this.canvas.style.left=`${(e-this.canvas.width)/2}px`,this.canvas.style.top=`${(i-this.canvas.height)/2}px`,console.log("Canvas positioned at:",this.canvas.style.left,this.canvas.style.top),this.player&&(this.player.width=30*this.scale,this.player.height=30*this.scale,this.player.speed=5*this.scale,this.player.x=Math.min(this.player.x,this.canvas.width-this.player.width),this.player.y=this.canvas.height-100*this.scale,console.log("Player updated:",this.player)),this.ctx.font=`${24*this.scale}px Arial`}handleTouch(e){e.preventDefault();const i=e.touches[0],t=this.canvas.getBoundingClientRect(),h=(i.clientX-t.left)/this.scale-(this.player.x+this.player.width/2);if(Math.abs(h)>0){this.player.x+=h/Math.abs(h)*this.player.speed;const a=20*this.scale;this.player.x=Math.max(a,Math.min(this.canvas.width-this.player.width-a,this.player.x))}this.keys[" "]=!0}createExplosion(e,i){this.explosions.push({x:e,y:i,radius:0,maxRadius:50,speed:2,active:!0}),this.soundManager.playExplosion()}initAliens(){const t=10+(this.level-1)*5,s=Math.ceil(Math.sqrt(t)),h=Math.ceil(t/s),a=60*this.scale,c=(this.canvas.width-s*a)/2,l=50*this.scale,r=500,n=2*this.scale,d=.2*this.scale,u=n+(this.level-1)*d;let f=0;for(let p=0;p<h&&f<t;p++)for(let w=0;w<s&&f<t;w++){const T=c+w*a,S=l+p*a;let y,m;const P=Math.random();P<.4?(y=-100*this.scale,m=this.canvas.height*.8+Math.random()*50*this.scale):P<.8?(y=this.canvas.width+100*this.scale,m=this.canvas.height*.8+Math.random()*50*this.scale):(y=T+(Math.random()-.5)*100*this.scale,m=-100*this.scale);const C=Math.random();let g;C<.1?g=3:C<.4?g=2:g=1;let v=u;g===2?v=u*1.5:g===3&&(v=u*.7),this.aliens.push({x:y,y:m,width:30*this.scale,height:30*this.scale,speed:v+Math.random(),direction:1,verticalSpeed:0,moveTimer:Date.now(),moveInterval:Math.max(500,1e3-(this.level-1)*50),lastBombTime:0,bombInterval:Math.max(500,1e3-(this.level-1)*50),nextBombDelay:1e3+Math.random()*1500,canDropBombs:!1,targetX:T,targetY:S,state:0,swoopPhase:Math.random()*Math.PI*2,swoopAmplitude:30*this.scale+Math.random()*20*this.scale,swoopSpeed:g===3?.04+Math.random()*.02:.02+Math.random()*.02,attackStartTime:0,originalX:T,originalY:S,entryDelay:f*r,type:g,bombSequence:0,lastBombSequence:0,isLeader:!1,followingLeader:null,attackPath:[],attackPathIndex:0}),f++}}initStars(){for(let e=0;e<100;e++)this.stars.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,size:Math.random()*2+1,speed:Math.random()*1.2+.5,color:this.getRandomDullColor()})}getRandomDullColor(){const e=["#8a8a8a","#8a4a4a","#4a8a4a","#4a4a8a","#8a8a4a","#8a4a8a","#4a8a8a","#6a6a8a","#8a6a4a"];return e[Math.floor(Math.random()*e.length)]}updateStars(){const e=Date.now();this.starPulseTime=(e-this.gameStartTime)/1e3,this.stars.forEach(i=>{if(this.gameStarted)i.y+=i.speed,i.y>this.canvas.height&&(i.y=0,i.x=Math.random()*this.canvas.width);else{const t=Math.sin(this.starPulseTime*2+i.x*.01)*.5+.5;i.size=(Math.random()*2+1)*(.5+t*.5)}})}drawStars(){this.stars.forEach(e=>{this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill()})}handleInput(){if(!this.gameStarted){(this.keys[" "]||this.keys.touch)&&(this.gameStarted=!0,this.initAliens());return}if(this.keys.Escape||this.keys.p||this.keys.P){this.isPaused=!this.isPaused,this.keys.Escape=!1,this.keys.p=!1,this.keys.P=!1;return}if(!this.isPaused){if(this.gameOver){const e=Date.now()-this.gameOverTime;(this.keys[" "]||this.keys.touch)&&e>=this.MIN_GAME_OVER_DURATION&&this.reset();return}if(this.keys.ArrowLeft){const e=20*this.scale;this.player.x=Math.max(e,this.player.x-this.player.speed)}if(this.keys.ArrowRight){const e=20*this.scale;this.player.x=Math.min(this.canvas.width-this.player.width-e,this.player.x+this.player.speed)}this.keys[" "]&&Date.now()-this.lastBulletTime>this.BULLET_COOLDOWN&&this.bullets.filter(i=>i.isPlayerBullet).length<this.MAX_PLAYER_BULLETS&&(this.bullets.push({x:this.player.x+this.player.width/2-2,y:this.player.y,width:4,height:10,speed:7,isPlayerBullet:!0}),this.lastBulletTime=Date.now(),this.soundManager.playShoot())}}reset(){this.player.x=this.canvas.width/2,this.player.y=this.canvas.height-100,this.bullets=[],this.bombs=[],this.explosions=[],this.aliens=[],this.stars=[],this.gameOver=!1,this.gameStarted=!1,this.gameOverTime=0,this.lastBulletTime=0,this.gameStartTime=Date.now(),this.score=0,this.level=1,this.levelStartTime=Date.now(),this.initStars(),this.soundManager.setGameOver(!1),this.isPaused=!1}handlePlayerDeath(){this.createExplosion(this.player.x+this.player.width/2,this.player.y+this.player.height/2),this.gameOver=!0,this.gameOverTime=Date.now(),this.soundManager.setGameOver(!0),this.soundManager.playGameOver()}startNextLevel(){this.score+=1e3,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("galagaHighScore",this.highScore.toString())),this.level++,this.levelStartTime=Date.now(),this.initAliens()}update(){if(this.isPaused)return;const e=Date.now(),i=e-this.gameStartTime;this.updateStars(),this.aliens.length===0&&e-this.levelStartTime>this.LEVEL_START_DELAY&&this.startNextLevel(),this.explosions=this.explosions.filter(t=>(t.radius+=t.speed,t.radius<t.maxRadius)),this.bullets=this.bullets.filter(t=>(t.isPlayerBullet?t.y-=t.speed:t.y+=t.speed,!this.gameOver&&!t.isPlayerBullet&&t.x<this.player.x+this.player.width&&t.x+t.width>this.player.x&&t.y<this.player.y+this.player.height&&t.y+t.height>this.player.y?(this.handlePlayerDeath(),!1):t.y>0&&t.y<this.canvas.height)),this.aliens.forEach(t=>{if(t.state===0&&i>=t.entryDelay&&(t.state=1),t.state!==0){if(!this.gameOver&&t.x<this.player.x+this.player.width&&t.x+t.width>this.player.x&&t.y<this.player.y+this.player.height&&t.y+t.height>this.player.y){this.handlePlayerDeath();return}switch(t.state){case 1:const s=t.targetX-t.x,h=t.targetY-t.y,a=Math.sqrt(s*s+h*h);a<5?(t.x=t.targetX,t.y=t.targetY,t.state=t.type===4?3:2,t.speed=2,t.originalX=t.x,t.originalY=t.y,t.moveTimer=e):(t.x+=s/a*t.speed,t.y+=h/a*t.speed);break;case 2:if(e-t.moveTimer>t.moveInterval&&this.aliens.forEach(c=>{c.state===2&&(c.direction*=-1,c.moveTimer=e,this.soundManager.playAlienHover(c.type))}),t.x+=t.speed*t.direction,t.x<0?(t.x=0,t.direction*=-1,this.soundManager.playAlienHover(t.type)):t.x+t.width>this.canvas.width&&(t.x=this.canvas.width-t.width,t.direction*=-1,this.soundManager.playAlienHover(t.type)),t.originalX=t.x,Math.random()<.001){t.state=3,t.attackStartTime=e,t.swoopPhase=0,t.isLeader=!0,t.attackPath=[],t.attackPathIndex=0;const c=this.aliens.filter(r=>r!==t&&r.state===2&&Math.abs(r.x-t.x)<100&&Math.abs(r.y-t.y)<100),l=Math.min(2,c.length);for(let r=0;r<l;r++){const n=c[r];n.state=3,n.attackStartTime=e+500,n.isLeader=!1,n.followingLeader=t,n.attackPath=[],n.attackPathIndex=0}}t.canDropBombs||e-t.entryDelay>t.nextBombDelay&&(t.canDropBombs=!0,t.lastBombTime=e);break;case 3:if(t.type===4){const c=e*.001,l=t.originalX+Math.sin(c*t.swoopSpeed)*t.swoopAmplitude,r=t.originalY+Math.sin(c*t.swoopSpeed*2)*(t.swoopAmplitude*.7),n=l-t.x,d=r-t.y;t.x+=n*.4,t.y+=d*.4,Math.random()<.04&&this.soundManager.playAlienHover(4),t.x<0&&(t.x=0),t.x+t.width>this.canvas.width&&(t.x=this.canvas.width-t.width),t.y<0&&(t.y=0),t.y+t.height>this.canvas.height&&(t.y=this.canvas.height-t.height)}else{const l=(e-t.attackStartTime)/3e3;if(l>=1)t.state=2,t.x=t.originalX,t.y=t.originalY,t.isLeader=!1,t.followingLeader=null,t.attackPath=[],t.attackPathIndex=0,this.soundManager.playAlienHover(t.type);else if(t.isLeader){const r=t.originalX+Math.sin(l*Math.PI*2)*100,n=t.originalY+Math.sin(l*Math.PI)*300;t.attackPath.push({x:r,y:n});const d=r-t.x,u=n-t.y;t.x+=d*.1,t.y+=u*.1}else if(t.followingLeader&&t.followingLeader.attackPath.length>0&&(t.attackPath.length===0&&(t.attackPath=[...t.followingLeader.attackPath]),t.attackPathIndex<t.attackPath.length)){const r=t.attackPath[t.attackPathIndex];if(r){const n=r.x-t.x,d=r.y-t.y;Math.sqrt(n*n+d*d)<5?t.attackPathIndex++:(t.x+=n*.1,t.y+=d*.1)}}}break}t.canDropBombs&&e-t.lastBombTime>(t.state===3?t.bombInterval*.3:t.bombInterval)&&t.y>0&&t.y<this.canvas.height&&(t.type===3?(t.bombSequence===0&&(t.bombSequence=1,t.lastBombSequence=e),t.bombSequence<=8&&e-t.lastBombSequence<2e3?(this.bombs.push({x:t.x+t.width/2-2,y:t.y+t.height,width:4,height:10,speed:3,horizontalSpeed:-1,active:!0,alienType:t.type}),this.bombs.push({x:t.x+t.width/2-2,y:t.y+t.height,width:4,height:10,speed:3,horizontalSpeed:1,active:!0,alienType:t.type}),t.bombSequence++,t.lastBombTime=e+50,this.soundManager.playBombDrop()):(t.bombSequence=0,t.lastBombTime=e+500+Math.random()*1e3)):(this.bombs.push({x:t.x+t.width/2-2,y:t.y+t.height,width:4,height:10,speed:3,horizontalSpeed:t.direction*.5,active:!0,alienType:t.type}),t.lastBombTime=e+200+Math.random()*800,this.soundManager.playBombDrop()))}}),this.bombs=this.bombs.filter(t=>(t.y+=t.speed,t.x+=t.horizontalSpeed,!this.gameOver&&t.active&&t.x<this.player.x+this.player.width&&t.x+t.width>this.player.x&&t.y<this.player.y+this.player.height&&t.y+t.height>this.player.y?(this.handlePlayerDeath(),!1):t.x<-t.width||t.x>this.canvas.width?!1:t.y<this.canvas.height&&t.active)),this.bullets=this.bullets.filter(t=>{if(!t.isPlayerBullet)return!0;const s=this.aliens.find(h=>t.x<h.x+h.width&&t.x+t.width>h.x&&t.y<h.y+h.height&&t.y+t.height>h.y);return s?(this.createExplosion(s.x+s.width/2,s.y+s.height/2),this.aliens=this.aliens.filter(h=>h!==s),this.score+=100,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("galagaHighScore",this.highScore.toString())),!1):!0})}draw(){if(this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawStars(),!this.gameStarted){this.ctx.fillStyle="#fff",this.ctx.font=`${36*this.scale}px Arial`,this.ctx.textAlign="center",this.ctx.fillText("GALAGA",this.canvas.width/2,this.canvas.height/2-50*this.scale),this.ctx.font=`${18*this.scale}px Arial`,this.ctx.fillText("100% vibe coded",this.canvas.width/2,this.canvas.height/2-10*this.scale),this.ctx.fillText("Press SPACE or touch screen to start",this.canvas.width/2,this.canvas.height/2+50*this.scale),this.ctx.fillStyle="#f00",this.ctx.font=`${16*this.scale}px Arial`,this.ctx.fillText("HIGH SCORE",this.canvas.width/2,30*this.scale),this.ctx.fillStyle="#fff",this.ctx.fillText(this.highScore.toString(),this.canvas.width/2,50*this.scale);return}if(this.ctx.font=`${20*this.scale}px Arial`,this.ctx.fillStyle="#fff",this.ctx.textAlign="left",this.ctx.fillText("SCORE",10*this.scale,30*this.scale),this.ctx.fillText(this.score.toString(),10*this.scale,55*this.scale),this.ctx.textAlign="center",this.ctx.fillStyle="#f00",this.ctx.font=`${16*this.scale}px Arial`,this.ctx.fillText("HIGH SCORE",this.canvas.width/2,30*this.scale),this.ctx.fillStyle="#fff",this.ctx.fillText(this.highScore.toString(),this.canvas.width/2,55*this.scale),this.ctx.textAlign="right",this.ctx.fillStyle="#fff",this.ctx.fillText("LEVEL",this.canvas.width-10*this.scale,30*this.scale),this.ctx.fillText(this.level.toString(),this.canvas.width-10*this.scale,55*this.scale),this.explosions.forEach(t=>{const s=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);s.addColorStop(0,"rgba(255, 255, 0, 0.8)"),s.addColorStop(.5,"rgba(255, 100, 0, 0.5)"),s.addColorStop(1,"rgba(255, 0, 0, 0)"),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill()}),!this.gameOver){this.ctx.save(),this.ctx.translate(this.player.x+this.player.width/2,this.player.y+this.player.height),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(0,-this.player.height),this.ctx.lineTo(-this.player.width/2,0),this.ctx.lineTo(this.player.width/2,0),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.moveTo(0,-this.player.height),this.ctx.lineTo(-this.player.width/2,0),this.ctx.lineTo(-this.player.width/4,-this.player.height/2),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#00f",this.ctx.beginPath(),this.ctx.moveTo(0,-this.player.height),this.ctx.lineTo(this.player.width/2,0),this.ctx.lineTo(this.player.width/4,-this.player.height/2),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.ellipse(0,-this.player.height/2,this.player.width/6,this.player.height/4,0,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(-this.player.width/2,0),this.ctx.lineTo(-this.player.width/2-10,-this.player.height/3),this.ctx.lineTo(-this.player.width/2,-this.player.height/2),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(this.player.width/2,0),this.ctx.lineTo(this.player.width/2+10,-this.player.height/3),this.ctx.lineTo(this.player.width/2,-this.player.height/2),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.rect(-this.player.width/2-2,-this.player.height/3,4,8),this.ctx.fill(),this.ctx.fillStyle="#00f",this.ctx.beginPath(),this.ctx.rect(-this.player.width/2-2,-this.player.height/2,4,8),this.ctx.fill(),this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.rect(this.player.width/2-2,-this.player.height/3,4,8),this.ctx.fill(),this.ctx.fillStyle="#00f",this.ctx.beginPath(),this.ctx.rect(this.player.width/2-2,-this.player.height/2,4,8),this.ctx.fill();const t=Date.now()*.005,s=10+Math.sin(t*2)*5,h=this.ctx.createLinearGradient(0,0,0,s);h.addColorStop(0,"#ff0"),h.addColorStop(.5,"#f80"),h.addColorStop(1,"#f00"),this.ctx.shadowColor="#f00",this.ctx.shadowBlur=15,this.ctx.shadowOffsetY=2,this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.moveTo(-this.player.width/4,0),this.ctx.lineTo(-this.player.width/6,s),this.ctx.lineTo(-this.player.width/8,0),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.moveTo(this.player.width/4,0),this.ctx.lineTo(this.player.width/6,s),this.ctx.lineTo(this.player.width/8,0),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowOffsetY=0,this.ctx.shadowColor="#fff",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(0,-this.player.height),this.ctx.lineTo(-this.player.width/2,0),this.ctx.lineTo(this.player.width/2,0),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}this.ctx.fillStyle="#fff",this.bullets.forEach(t=>{this.ctx.fillRect(t.x,t.y,t.width,t.height)}),this.bombs.forEach(t=>{switch(t.alienType){case 1:this.ctx.fillStyle="#ff0";break;case 2:this.ctx.fillStyle="#f00";break;case 3:this.ctx.fillStyle="#0ff";break;default:this.ctx.fillStyle="#f00"}this.ctx.fillRect(t.x,t.y,t.width,t.height)}),this.aliens.forEach(t=>{switch(this.ctx.save(),this.ctx.translate(t.x+t.width/2,t.y+t.height/2),t.type){case 1:this.ctx.fillStyle="#00f",this.ctx.beginPath(),this.ctx.ellipse(-t.width/2,-t.height/6,t.width/2.5,t.height/4,Math.PI/4,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.ellipse(t.width/2,-t.height/6,t.width/2.5,t.height/4,-Math.PI/4,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ff0",this.ctx.beginPath(),this.ctx.ellipse(0,0,t.width/3,t.height/2,0,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000",this.ctx.fillRect(-t.width/3,-t.height/4,t.width/1.5,t.height/8),this.ctx.fillRect(-t.width/3,t.height/8,t.width/1.5,t.height/8),this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.arc(-t.width/6,-t.height/4,t.width/12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.width/6,-t.height/4,t.width/12,0,Math.PI*2),this.ctx.fill();break;case 2:this.ctx.fillStyle="#f00",this.ctx.beginPath(),this.ctx.moveTo(-t.width/2,-t.height/6),this.ctx.bezierCurveTo(-t.width/1.2,-t.height/3,-t.width,-t.height/4,-t.width/2,t.height/2),this.ctx.bezierCurveTo(-t.width/2.5,t.height/3,-t.width/3,-t.height/6,-t.width/2,-t.height/6),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t.width/2,-t.height/6),this.ctx.bezierCurveTo(t.width/1.2,-t.height/3,t.width,-t.height/4,t.width/2,t.height/2),this.ctx.bezierCurveTo(t.width/2.5,t.height/3,t.width/3,-t.height/6,t.width/2,-t.height/6),this.ctx.fill(),this.ctx.strokeStyle="#800",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(-t.width/2,-t.height/6),this.ctx.bezierCurveTo(-t.width/1.5,-t.height/4,-t.width/1.3,-t.height/5,-t.width/2,t.height/4),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t.width/2,-t.height/6),this.ctx.bezierCurveTo(t.width/1.5,-t.height/4,t.width/1.3,-t.height/5,t.width/2,t.height/4),this.ctx.stroke();const s=this.ctx.createLinearGradient(0,-t.height/2,0,t.height/2);s.addColorStop(0,"#fff"),s.addColorStop(1,"#4af"),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.ellipse(0,0,t.width/3,t.height/2,0,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.arc(-t.width/5,-t.height/4,t.width/6,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.width/5,-t.height/4,t.width/6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(-t.width/5,-t.height/4,t.width/8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.width/5,-t.height/4,t.width/8,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#00f",this.ctx.beginPath(),this.ctx.arc(0,0,t.width/6,0,Math.PI*2),this.ctx.fill();break;case 3:this.ctx.fillStyle="#808",this.ctx.beginPath(),this.ctx.moveTo(-t.width/2,-t.height/6),this.ctx.bezierCurveTo(-t.width/1.8,t.height/3,-t.width/2,t.height/2,-t.width/2.5,t.height*.8),this.ctx.bezierCurveTo(-t.width/3,t.height/2,-t.width/2.5,t.height/3,-t.width/2,-t.height/6),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t.width/2,-t.height/6),this.ctx.bezierCurveTo(t.width/1.8,t.height/3,t.width/2,t.height/2,t.width/2.5,t.height*.8),this.ctx.bezierCurveTo(t.width/3,t.height/2,t.width/2.5,t.height/3,t.width/2,-t.height/6),this.ctx.fill(),this.ctx.strokeStyle="#404",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(-t.width/2,-t.height/6),this.ctx.bezierCurveTo(-t.width/1.9,t.height/4,-t.width/2.2,t.height/2,-t.width/2.5,t.height*.8),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t.width/2,-t.height/6),this.ctx.bezierCurveTo(t.width/1.9,t.height/4,t.width/2.2,t.height/2,t.width/2.5,t.height*.8),this.ctx.stroke(),this.ctx.fillStyle="#a0a",this.ctx.beginPath(),this.ctx.ellipse(0,0,t.width/3,t.height/2,0,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowColor="#f0f",this.ctx.shadowBlur=10,this.ctx.fillStyle="#f0f",this.ctx.beginPath(),this.ctx.arc(-t.width/6,-t.height/4,t.width/8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.width/6,-t.height/4,t.width/8,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(-t.width/6,-t.height/4,t.width/12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t.width/6,-t.height/4,t.width/12,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#f0f",[{x:0,y:0},{x:-t.width/6,y:t.height/4},{x:t.width/6,y:t.height/4}].forEach(a=>{this.ctx.beginPath(),this.ctx.arc(a.x,a.y,t.width/16,0,Math.PI*2),this.ctx.fill()});break}this.ctx.strokeStyle="#000",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(-t.width/8,-t.height/2),this.ctx.lineTo(-t.width/6,-t.height),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t.width/8,-t.height/2),this.ctx.lineTo(t.width/6,-t.height),this.ctx.stroke(),this.ctx.shadowColor=t.type===1?"#ff0":t.type===2?"#fff":"#00f",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.ellipse(0,0,t.width/3,t.height/2,0,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}),this.isPaused&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#fff",this.ctx.font=`${36*this.scale}px Arial`,this.ctx.textAlign="center",this.ctx.fillText("PAUSED",this.canvas.width/2,this.canvas.height/2),this.ctx.font=`${18*this.scale}px Arial`,this.ctx.fillText("Press ESC or P to resume",this.canvas.width/2,this.canvas.height/2+50*this.scale)),this.gameOver&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#fff",this.ctx.font=`${36*this.scale}px Arial`,this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2),Date.now()-this.gameOverTime>=this.MIN_GAME_OVER_DURATION&&(this.ctx.font=`${18*this.scale}px Arial`,this.ctx.fillText("Press SPACE or touch screen to restart",this.canvas.width/2,this.canvas.height/2+50*this.scale))),this.ctx.font=`${14*this.scale}px Arial`,this.ctx.textAlign="left",this.ctx.fillStyle="#0f0";const e=this.soundManager.isEnabled()?"🔊":"🔇",i=this.isMobile()?"":" (M to toggle)";this.ctx.fillText(`Sound ${e}${i}`,10*this.scale,this.canvas.height-10*this.scale)}gameLoop(){this.handleInput(),this.update(),this.draw(),requestAnimationFrame(()=>this.gameLoop())}}new k;
